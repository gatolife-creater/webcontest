# 第二節　ブロックチェーンの基礎となる技術

先生：それではブロックチェーンの基礎となる技術の仕組みと、その活用例を見ていこう。

## Peer to Peer（P2P）

生徒：ぺ、ぺあとーぺあ？

先生：**ピア・ツー・ピア**だ。これはブロックチェーンにおいて、最も重要であると言っても過言ではない。

先生：一般的に用いられる、**クライアント・サーバー・システム**にはないメリットがある。

生徒：ピア・ツー・ピアにクライアント・サーバー・システム？聞きなれない言葉ばっかり...

先生：では、我々の生活に馴染み深いクライアント・サーバー・システムから解説しよう。

***
クライアント・サーバー・システムは、コンピューターを**クライアント**と**サーバー**に役割分担して、データをやり取りする仕組みです。<br>
クライアントは、サーバーに**データを要求し**、それを受け取るコンピューター、<br>
サーバーは、クライアントからの要求に応じて、**データを提供する**コンピューターです。
***

先生：つまり、サーバーはたくさんのコンピューターにデータを提供する、偉〜いコンピューターなのだ。

先生：イザワ君、ピア・ツー・ピアとクライアント・サーバー・システムの図を用意してくれ。

助手：かしこまりました。

### クライアント・サーバー・システム
***
![クライアントサーバーシステムの図](/public/imgs/クライアント・サーバー・システム.jpeg)

先生：これがクライアント・サーバー・システムを表した図だ。真ん中のものがサーバー、その他のものがクライアントだ。クライアントはサーバーにデータの要求を行い、サーバーはその要求に応じて、データをクライアントに提供する。

生徒：クライアント側にスマートフォンやパソコンがありますね！

先生：そうだ。例えば我々はYouTubeを見る時、スマホを使うだろう？つまり、我々のスマホが**クライアント**としてYouTubeの**サーバー**に動画のデータを要求しているというわけだ。

生徒：なるほど〜。

先生：それでは、次にピア・ツー・ピアを見ていこう。

### ピア・ツー・ピア
***

先生：ピア・ツー・ピアは直訳すると「**対等なもの**から**対等なもの**へ」だな。

先生：ピア・ツー・ピアはよく下のような図で表される。

![ピア・ツー・ピアの図](/public/imgs/ピア・ツー・ピア.jpg)

生徒：あれ？サーバーが見当たらないですね...

先生：いいところに気がついたな！そう、ピア・ツー・ピアにはクライアント、サーバーという役割分担が存在しないのだ。

生徒：じゃあどうやってデータをやりとりしているんですか？

先生：それは実にシンプルだ。各コンピューターが対等な立場で、他のコンピューターにデータを要求すると同時に、データを提供しているのだ。

助手：つまり、それぞれのコンピューターがクライアントとサーバー、両方の役割を担っているとも言えますね。

先生：その通りだ。さすがイザワ君。全てのコンピューターが同じ役割を持っているから、**「対等なもの」**というわけだな。

生徒：そう言えば、ピア・ツー・ピアのメリットって何ですか。

先生：それは、**一部のコンピューターだけに負担がかかることがないという点だ。**

先生：下の図を見てみよう。

![サーバー・クライアント・システムの障害](/public/imgs/クライアント・サーバー・システム（障害）.jpeg)

生徒：うわぁ、サーバー燃えとる...

先生：これはサーバーに障害が出ていることを表している。この図から分かる通り、サーバーが正常に動作していないと、全てのクライアントはデータを入手することができない。従って、サーバーの障害はシステム全体に影響を及ぼすことになる。

助手：クライアント・サーバー・システムは**サーバーに依存したシステム**、ということですね。

生徒：じゃあ、ピア・ツー・ピアの方はどうなんですか？

先生：これを見てみろ。

![ピア・ツー・ピアの障害](/public/imgs/ピア・ツー・ピア（障害）.jpg)

生徒：一部のコンピューターに障害が発生しているようですね。

生徒：あっ、でも他のコンピューターは通信できてる！

先生：その通り。ピア・ツー・ピアなら一部のコンピューターに障害が発生しても、他のコンピューターが動き続けているかぎり、システムは正常に機能するのだ。

## ハッシュ関数

***
ハッシュ関数は別名 **要約関数**とも呼ばれ、入力した値をもとにランダムに見える値を出力します。<br />
また、ハッシュ関数には以下のような特徴があります。
* 入力した値の長さに関わらず、**常に同じ長さの値を出力する**。
* 同じ値を入力すれば、**常に同じ値が出力される**。
* ハッシュ値から、**元の値を復元**することはできない。

なお、ハッシュ関数に値を入力することを**ハッシュ化**、ハッシュ関数によって出力された値のことを**ハッシュ値**と言います。
***

![ハッシュ関数の図](/public/imgs/ハッシュ関数.jpg)

助手：ハッシュ関数のサンプルも作っておきました。これで1と2の特徴を確かめることができます。

<span style="color:yellow;">（ハッシュ関数のサンプル）</span>

生徒：それにしても、ハッシュ関数って一体なんの役に立つんですか？

先生：うむ。いい質問だ。実は、**改ざん検知**や**認証システム**に活用されているのだよ。

### 改ざん検知
***

先生：まずは下の図を見てみよう。これはデータ送信の流れを簡略化した図だ。何の変哲もない図だが、ここには一つ問題がある。

![](/public/imgs/データ送信.jpg)

先生：何も対策をしていなければ、データが改ざんされても、それを知る術はない。

生徒：もしも会社でやりとりされるようなデータだと大変ですね。

![](/public/imgs/データ送信（改ざん）.jpg)

先生：そこで、ハッシュ関数が役立つのだよ。まず、送信したいデータのハッシュ値をあらかじめ受信者に送信しておく。それからデータを送るのだ。その後、受信者側でそのデータのハッシュ値を求めたのちに、送信者から受け取っていたハッシュ値と照合することでデータが改ざんされているか否か、判断することができる。　

![](/public/imgs/データ送信（改ざん検知1）.jpg)

先生：では、このような対策をしている状態で、データの送信の際に改ざんされたらどうなるだろうか？

生徒：データが改ざんされるとハッシュ値が変わるから、あらかじめ受け取ったハッシュ値と一致しない！だから改ざんされていることがわかるのか！

先生：その通り！


![](/public/imgs/データ送信（改ざん検知2）.jpg)

先生：まとめると、
* 同じ値を入力すると、同じ値が出力される。
* 入力値が少し違うだけで、結果が大きく異なる。
この二つの特徴を利用して改ざんを検知しているのだ。

### 認証システム
***
先生：ハッシュ関数は認証システム、つまりログイン、サインインを行うシステムにも活用されている。

生徒：具体的にどのようなところに活用されているのですか？

先生：

先生：下の図を見てみよう。

<span style="color:yellow;">NOTE：ここに、ハッシュ関数を活用した認証システムの図を使う。</span>

先生：ユーザーが入力したパスワードをハッシュ化し、

生徒：出力値からは入力値を推測できないという性質が役立っていますね！

## 公開鍵暗号方式
***
**公開鍵暗号方式**は、**暗号技術**の一種です。

＊ 暗号技術・・・PDF等のデータを他人に盗み見られることなく、他の人と安全にデータをや取りする技術。

用語がやや難しく聞こえるので、ここで少し勉強していきましょう。

まずは、**公開鍵**。
公開鍵とは、**データを暗号化するときに使われる**鍵です。その名の通り、誰でも使えるように外部に**公開**されており、**秘密鍵**から作られています。

次に**秘密鍵**。<br />
これは、公開鍵で暗号化したデータを
**復号するための鍵**です。
そして、この鍵を所持するのは鍵を作成した人のみ。
**他の人に公開することはありません**。
***

生徒：公開鍵暗号方式...。なんだか難しそうな響きですね。

先生：安心しろ。決して難しい仕組みではない。**秘密鍵**で暗号化し、**公開鍵**で復号するだけだ。

生徒：はぁ...。

先生：ナカモト君、下の図を見てみろ。これは、公開鍵暗号方式の仕組みを簡単にあらわしたものだ。

生徒： まずは受信者が**秘密鍵**と**公開鍵**を作るんですね

![公開鍵暗号方式の仕組みの図](/public/imgs/公開鍵暗号方式.jpg)

## デジタル署名

生徒：デジタル署名って何ができるんですか？

先生：改ざんの検出、そして**否認の防止**だ。

<!-- <ごめん否認の防止が分からぬ -->

先生：公開鍵で復号できるようにすることで、誰もが復号できるようにしている。

生徒：それじゃあ暗号化の意味ないじゃないですか！

先生：そこが重要なのだよ。誰もが復号できるようにすることで、誰もが署名（データ送信者の照合）を確認することができるのだ。

***
※否認・・・データを送信したにも関わらず、送信したことことを否定すること。インターネット上において、どれが元のデータであるか区別することは難しいため、デジタル署名のような方法が採用されている。
***

## まとめ

先生：これらの技術がブロックチェーンの土台だ。かなり難しかっただろう。よく頑張った。次のページではブロックチェーンの長所や使い道について説明するぞ。